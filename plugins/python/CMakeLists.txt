EXECUTE_PROCESS(COMMAND python-config --includes
    OUTPUT_VARIABLE PYTHON_CFLAGS
    OUTPUT_STRIP_TRAILING_WHITESPACE)

EXECUTE_PROCESS(COMMAND python-config --libs
    OUTPUT_VARIABLE PYTHON_LDFLAGS
    OUTPUT_STRIP_TRAILING_WHITESPACE)

IF(NOT PYTHON_CFLAGS OR NOT PYTHON_LDFLAGS)
    MESSAGE(SEND_ERROR, "Python development headers are required.")
ENDIF()

FIND_FILE(CURL_HEADER "curl.h" PATH_SUFFIXES "curl" "libcurl")
GET_FILENAME_COMPONENT(CURL_HEADER_PATH ${CURL_HEADER} PATH)

IF(NOT CURL_HEADER)
    MESSAGE(SEND_ERROR "CURL development headers are required.")
ENDIF()

ADD_LIBRARY(yappi-plugin-python MODULE
    python)

TARGET_LINK_LIBRARIES(yappi-plugin-python
    curl)

SET_TARGET_PROPERTIES(yappi-plugin-python PROPERTIES
    COMPILE_FLAGS "${PYTHON_CFLAGS}"
    LINK_FLAGS "${PYTHON_LDFLAGS}")
